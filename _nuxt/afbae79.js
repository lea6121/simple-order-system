(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{387:function(t,e,r){"use strict";var n=r(5),o=r(71).find,c=r(129),d="find",l=!0;d in[]&&Array(1).find((function(){l=!1})),n({target:"Array",proto:!0,forced:l},{find:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),c(d)},388:function(t,e,r){var n=r(3),o=r(22),c=r(11),d=r(389),l=n("".replace),f="["+d+"]",m=RegExp("^"+f+f+"*"),h=RegExp(f+f+"*$"),v=function(t){return function(e){var r=c(o(e));return 1&t&&(r=l(r,m,"")),2&t&&(r=l(r,h,"")),r}};t.exports={start:v(1),end:v(2),trim:v(3)}},389:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},390:function(t,e,r){"use strict";var n=r(13),o=r(1),c=r(3),d=r(131),l=r(18),f=r(14),m=r(255),h=r(47),v=r(130),k=r(254),y=r(6),I=r(92).f,x=r(38).f,O=r(17).f,_=r(391),N=r(388).trim,w="Number",S=o.Number,P=S.prototype,E=o.TypeError,j=c("".slice),D=c("".charCodeAt),F=function(t){var e=k(t,"number");return"bigint"==typeof e?e:C(e)},C=function(t){var e,r,n,o,c,d,l,code,f=k(t,"number");if(v(f))throw E("Cannot convert a Symbol value to a number");if("string"==typeof f&&f.length>2)if(f=N(f),43===(e=D(f,0))||45===e){if(88===(r=D(f,2))||120===r)return NaN}else if(48===e){switch(D(f,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+f}for(d=(c=j(f,2)).length,l=0;l<d;l++)if((code=D(c,l))<48||code>o)return NaN;return parseInt(c,n)}return+f};if(d(w,!S(" 0o1")||!S("0b1")||S("+0x1"))){for(var V,$=function(t){var e=arguments.length<1?0:S(F(t)),r=this;return h(P,r)&&y((function(){_(r)}))?m(Object(e),r,$):e},A=n?I(S):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),T=0;A.length>T;T++)f(S,V=A[T])&&!f($,V)&&O($,V,x(S,V));$.prototype=P,P.constructor=$,l(o,w,$)}},391:function(t,e,r){var n=r(3);t.exports=n(1..valueOf)},392:function(t,e,r){"use strict";var n=r(5),o=r(388).trim;n({target:"String",proto:!0,forced:r(393)("trim")},{trim:function(){return o(this)}})},393:function(t,e,r){var n=r(91).PROPER,o=r(6),c=r(389);t.exports=function(t){return o((function(){return!!c[t]()||"​᠎"!=="​᠎"[t]()||n&&c[t].name!==t}))}},394:function(t,e,r){var content=r(400);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(90).default)("7800b20b",content,!0,{sourceMap:!1})},399:function(t,e,r){"use strict";r(394)},400:function(t,e,r){var n=r(89)(!1);n.push([t.i,".el-container{height:100vh}.el-container .el-submenu .el-menu-item{padding:0;font-size:16px}.el-container .el-container.btn-container{width:100%;border:none;display:flex;justify-content:space-between;max-height:80px;padding:20px}.el-container .el-container.btn-container .el-button.add-btn{height:50px}.el-container .el-dialog .dialog-btn-container{border:none;display:flex;justify-content:space-between;height:5em;align-items:center}.el-container .el-dialog .dialog-btn-container .add-product-btn{margin-button:0}.el-container .el-dialog__header{text-align:center;padding:20px}.el-container .el-dialog__title{font-size:26px;display:block;padding:10px}.el-container .el-dialog__headerbtn{display:none}.el-container .el-dialog__body table{width:100%;margin:0 auto 10px}.el-container .el-dialog__body table thead{width:100%;background:rgba(0,0,0,.2)}.el-container .el-dialog__body table thead tr{height:40px;line-height:40px;text-align:center}.el-container .el-dialog__body table thead th{border:2px solid #fff}.el-container .el-dialog__body table tbody{width:100%;background:rgba(0,0,0,.1)}.el-container .el-dialog__body table tbody td{padding:10px;border:2px solid #fff}.el-container .el-dialog__body table tbody .el-select{padding:4px}.el-container .el-dialog__body table tbody .btn{padding:10px}.el-container .el-dialog__body table tbody .btn,.el-container .el-dialog__body table tbody .el-select{margin:0 auto;display:block;width:-webkit-fill-available;font-size:16px}.el-container .el-header{background-color:rgba(0,0,0,.1);color:#333;line-height:60px;font-size:20px;font-weight:500;display:flex;justify-content:space-between;align-items:center}.el-container .el-header .el-button{padding:13px}.el-container .el-aside{color:#333}.el-container .el-table{margin-bottom:10px}.el-container .el-table thead.is-group th.el-table__cell{background:rgba(0,0,0,.2)}.el-container .cell{font-size:15px;text-align:center;color:rgba(0,0,0,.8);white-space:break-spaces!important;word-break:break-word}.el-container .is-right .cell{display:grid;justify-content:center}.el-container .is-right .cell button{margin:2px}",""]),t.exports=n},410:function(t,e,r){"use strict";r.r(e);r(46),r(29),r(72),r(37),r(73);var n=r(28),o=r(27),c=(r(12),r(95),r(45),r(387),r(39),r(390),r(183),r(132),r(392),r(94),r(59),r(75),r(93),r(44));function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function l(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var f={name:"OrdersPage",data:function(){return{dialogFormVisible:!1,userFilter:"1640433987122",orderItems:{id:Date.now().toString(),userId:"",username:"",products:[{id:"",name:"",price:"",quantity:"",stock:""}],remark:""},oldOrderProducts:[]}},computed:l({setOrdersData:function(){return this.filterUserOrders()}},Object(c.c)(["orders","stock","users"])),methods:l(l({},Object(c.b)(["addNewOrder","deleteOrder","modifyOrder","modifyProduct"])),{},{openError:function(t){this.$message({showClose:!0,message:t,type:"error"})},openSuccess:function(t){this.$message({showClose:!0,message:t,type:"success"})},goToStock:function(){this.$router.push("/admin/stock")},filterUserOrders:function(){var t=this.userFilter,e=this.orders.filter((function(e){return e.userId===t}));return t&&"1640433987122"===t?this.$store.state.orders:e},findData:function(t,e){var r=this.stock.find((function(e){return e.productId===t}));r&&(this.orderItems.products[e].name=r.productName,this.orderItems.products[e].price=r.price,this.orderItems.products[e].stock=r.stock)},findUser:function(t){var e=this.users.find((function(e){return e.userId===t}));this.orderItems.username=e.username},renderTitles:function(t){return t.reduce((function(t,e){return t+"".concat(e.name,"\n")}),"")},renderPrices:function(t){return t.reduce((function(t,e){return t+"$ ".concat(e.price,"\n")}),"")},renderQuantities:function(t){return t.reduce((function(t,e){return t+"".concat(e.quantity,"\n")}),"")},openDetails:function(t){this.$router.push("/admin/orders/".concat(t))},handleDelete:function(t){for(var e=this,r=JSON.parse(JSON.stringify(this.orders[t].products)),o=function(i){var n=e.stock.filter((function(t){return t.productId===r[i].id}));if(0===n.length)return e.deleteOrder(t),{v:void 0};var o=Number(r[i].quantity),c=Number(n[0].stock)+o,d=e.stock.findIndex((function(t){return t.productId===r[i].id}));e.stock[d].stock=c.toString()},i=0;i<r.length;i++){var c=o(i);if("object"===Object(n.a)(c))return c.v}this.deleteOrder(t)},handleEdit:function(t,e){var r=JSON.parse(JSON.stringify(this.orders[t].products)),n=this.orders[t].remark;this.orderItems.id=e,this.orderItems.userId=this.orders[t].userId,this.orderItems.username=this.orders[t].username,this.orderItems.products=r,this.orderItems.remark=n,this.oldOrderProducts=JSON.parse(JSON.stringify(this.orderItems.products))},handleAddProduct:function(){this.orderItems.products.push({id:"",name:"",price:"",quantity:"",stock:""})},handleDeleteProduct:function(t){this.orderItems.products.splice(t,1)},formValidation:function(t){var e=!0;return!t.name.trim()||Number(t.price.trim())<1||Number(t.quantity.trim())<1?(e=!1,this.dialogFormVisible=!0,e):e},reset:function(){this.orderItems={id:Date.now().toString(),products:[{id:"",name:"",price:"",quantity:"",stock:""}],remark:""},this.oldOrderProducts=[]},calculateAddStock:function(data){for(var t=this,e=!0,r=function(i){var r=t.stock.filter((function(t){return t.productId===data[i].id})),n=Number(r[0].stock)-Number(data[i].quantity);if(n<0){var o="".concat(r[0].productName,"現有庫存為 ").concat(r[0].stock,"，請重新訂購。");t.openError(o),e=!1}else{var c=t.stock.findIndex((function(t){return t.productId===data[i].id}));t.stock[c].stock=n.toString()}},i=0;i<data.length;i++)r(i);return e},findDuplicateProduct:function(data){var t,e=data.map((function(t){return t.id})),r=data.filter((function(t){return t.id===e[0]}));var n=data.reduce((function(e,r,i){return e[r.id]?(data[i+1]&&data[i+1].name!==t||!data[i+1])&&(e[r.id].index.push(i),e[r.id].count++):(t=r.id,e[r.id]={count:1,index:[i]}),e}),{});data[n[e[0]].index[0]].quantity=function(t){for(var e=0,i=0;i<t.length;i++)e+=Number(t[i].quantity);return e}(r).toString();for(var i=1;i<n[e[0]].index.length;i++)data.splice(n[e[0]].index[i],1)},addOrderConfirmation:function(){if(0!==this.orderItems.products.length)if(this.orderItems.userId&&this.orderItems.username){this.findDuplicateProduct(this.orderItems.products);for(var i=0;i<this.orderItems.products.length;i++){var t=this.orderItems.products[i];if(!this.formValidation(t)){return void this.openError("新增失敗，請填入應填資訊。")}}var e=JSON.parse(JSON.stringify(this.orderItems));this.calculateAddStock(e.products)&&(this.addNewOrder(e),this.dialogFormVisible=!1,this.reset(),this.openSuccess("訂單新增成功。"))}else{this.openError("請選擇使用者下單。")}else this.reset()},removeDuplicates:function(t){var e=t.map((function(t){return t.id}));return t.filter((function(t,r){var n=t.id;return!e.includes(n,r+1)}))},calculateUpdateStock:function(data){for(var t=this,e=data.concat(this.oldOrderProducts),r=this.removeDuplicates(e),o=!0,c=function(i){var e=t.stock.filter((function(t){return t.productId===r[i].id})),n=0,c=0,d=0,l=data.some((function(t){return t.id===r[i].id})),f=t.oldOrderProducts.some((function(t){return t.id===r[i].id}));if(f&&l){var m=t.oldOrderProducts.findIndex((function(t){return t.id===r[i].id})),h=data.findIndex((function(t){return t.id===r[i].id}));if(n=Number(t.oldOrderProducts[m].quantity),c=Number(data[h].quantity),0===e.length)d=n;else{if((d=Number(e[0].stock)+n-c)<0){var v="".concat(e[0].productName,"現有庫存為 ").concat(e[0].stock,"，請更改下訂數量。");return t.openError(v),o=!1,{v:void 0}}var k=t.stock.findIndex((function(t){return t.productId===r[i].id}));t.stock[k].stock=d.toString()}}if(f&&!l){var y=t.oldOrderProducts.findIndex((function(t){return t.id===r[i].id}));n=Number(t.oldOrderProducts[y].quantity);var I=0;if(0===e.length)I=n;else{if((I=Number(e[0].stock)+n)<0){var x="".concat(e[0].productName,"現有庫存為 ").concat(e[0].stock,"，請更改下訂數量。");return t.openError(x),o=!1,{v:void 0}}var O=t.stock.findIndex((function(t){return t.productId===r[i].id}));t.stock[O].stock=I.toString()}}if(!f&&l){var _=data.findIndex((function(t){return t.id===r[i].id}));c=Number(data[_].quantity);var N=Number(e[0].stock)-c;if(N<0){var w="".concat(e[0].productName,"現有庫存為 ").concat(e[0].stock,"，請更改下訂數量。");return t.openError(w),o=!1,{v:void 0}}var S=t.stock.findIndex((function(t){return t.productId===r[i].id}));t.stock[S].stock=N.toString()}},i=0;i<r.length;i++){var d=c(i);if("object"===Object(n.a)(d))return d.v}return o},editConfirmation:function(t){if(0!==this.orderItems.products.length){this.findDuplicateProduct(this.orderItems.products);for(var i=0;i<this.orderItems.products.length;i++){if(!this.orderItems.userId||!this.orderItems.username)return;var e=this.orderItems.products[i];if(!this.formValidation(e)){return void this.openError("更新失敗，請填入應填資訊。")}}this.calculateUpdateStock(this.orderItems.products)&&(this.modifyOrder(this.orderItems),this.dialogFormVisible=!1,this.reset(),this.openSuccess("訂單更新成功！"))}},handleConfirm:function(){var t=this.orderItems.id;this.orders.find((function(e){return e.id===t}))?this.editConfirmation(t):this.addOrderConfirmation()}})},m=(r(399),r(58)),component=Object(m.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-container",{staticStyle:{border:"1px solid #eee"}},[r("el-aside",{staticStyle:{"background-color":"rgb(238, 241, 246)"},attrs:{width:"15%"}},[r("el-menu",{attrs:{"default-openeds":["1","2"]}},[r("el-submenu",{attrs:{index:"1"}},[r("template",{slot:"title"},[r("i",{staticClass:"el-icon-setting"})]),r("el-menu-item",{attrs:{index:"1-1"}},[t._v("訂單管理")]),r("el-menu-item",{attrs:{index:"1-2"},on:{click:t.goToStock}},[t._v("庫存管理")])],2)],1)],1),r("el-container",[r("el-header",[r("h1",[t._v("訂單管理")])]),r("el-container",{staticClass:"btn-container"},[r("el-button",{staticClass:"add-btn",on:{click:function(e){t.dialogFormVisible=!0}}},[t._v("新增訂單")]),r("el-select",{attrs:{placeholder:"篩選使用者訂單"},on:{change:t.filterUserOrders},model:{value:t.userFilter,callback:function(e){t.userFilter=e},expression:"userFilter"}},t._l(t.users,(function(t,e){return r("el-option",{key:e,attrs:{label:t.username,value:t.userId}})})),1)],1),r("el-main",[r("el-table",{attrs:{data:t.setOrdersData}},[r("el-table-column",{attrs:{type:"index",label:""}}),r("el-table-column",{attrs:{prop:"id",label:"編號"},on:{click:function(e){return t.openDetails(t.scope.row.id)}}}),r("el-table-column",{attrs:{prop:"username",label:"會員"}}),r("el-table-column",{attrs:{prop:"",label:"商品"}},[r("el-table-column",{attrs:{prop:"products",label:"名稱",formatter:function(e,r,n){return t.renderTitles(n)}}}),r("el-table-column",{attrs:{prop:"products",label:"價格",formatter:function(e,r,n){return t.renderPrices(n)}}}),r("el-table-column",{attrs:{prop:"products",label:"數量",formatter:function(e,r,n){return t.renderQuantities(n)}}})],1),r("el-table-column",{attrs:{prop:"remark",label:"備註"}}),r("el-table-column",{staticClass:"btns",attrs:{align:"right",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(r){return t.openDetails(e.row.id)}}},[t._v("詳情")]),r("el-button",{attrs:{size:"mini"},on:{click:function(r){t.handleEdit(e.$index,e.row.id),t.dialogFormVisible=!0}}},[t._v("編輯")]),r("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(r){return t.handleDelete(e.$index)}}},[t._v("刪除")])]}}])})],1),r("el-dialog",{attrs:{title:"訂單內容",visible:t.dialogFormVisible,width:"60%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[r("el-container",{staticClass:"dialog-btn-container"},[r("el-button",{staticClass:"add-product-btn",on:{click:t.handleAddProduct}},[t._v("新增項目")]),r("el-select",{attrs:{placeholder:"請選擇使用者新增訂單"},on:{change:function(e){return t.findUser(t.orderItems.userId)}},model:{value:t.orderItems.userId,callback:function(e){t.$set(t.orderItems,"userId",e)},expression:"orderItems.userId"}},t._l(t.users,(function(t,e){return r("el-option",{key:e,attrs:{label:t.username,value:t.userId}})})),1)],1),r("table",[r("thead",[r("tr",[r("th",[t._v("名稱")]),r("th",[t._v("價格")]),r("th",[t._v("數量（需大於 0 筆）")]),r("th",[t._v("操作")])])]),r("tbody",t._l(t.orderItems.products,(function(e,n){return r("tr",{key:n},[r("td",[r("el-select",{attrs:{placeholder:"請選擇商品"},on:{change:function(r){return t.findData(e.id,n)}},model:{value:e.id,callback:function(r){t.$set(e,"id",r)},expression:"item.id"}},t._l(t.stock,(function(t,e){return r("el-option",{key:e,attrs:{label:t.productName,value:t.productId}})})),1)],1),r("td",[r("el-input",{attrs:{type:"number",placeholder:e.price,disabled:""},model:{value:e.price,callback:function(r){t.$set(e,"price",r)},expression:"item.price"}})],1),r("td",[r("el-input",{attrs:{type:"number",placeholder:"請輸入商品數量",min:"1",max:e.stock},model:{value:e.quantity,callback:function(r){t.$set(e,"quantity",r)},expression:"item.quantity"}})],1),r("td",[r("el-button",{staticClass:"btn",on:{click:function(e){return t.handleDeleteProduct(n)}}},[t._v("刪除")])],1)])})),0)]),r("el-input",{attrs:{type:"textarea",rows:2,placeholder:"備註"},model:{value:t.orderItems.remark,callback:function(e){t.$set(t.orderItems,"remark",e)},expression:"orderItems.remark"}}),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.reset(),t.dialogFormVisible=!1}}},[t._v("取消")]),r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.handleConfirm()}}},[t._v("確定")])],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);